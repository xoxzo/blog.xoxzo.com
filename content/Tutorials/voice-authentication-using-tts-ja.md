Title: テキスト読み上げ機能を使って、電話で認証してみましょう! 
Date: 2021-11-01 10:00
Author: Miko-chan
Tags: 通話; 音声; テキスト読み上げ; api; チュートリアル; ミコちゃん; 認証;
Slug: making-a-voice-authentication-call-with-tts
Thumbnail: images/xoxtan.png
Lang: ja
Summary: このチュートリアルでは、APIをひとつ呼び出すだけで、テキスト読み上げ機能を使って、どうやって認証コードを読むのか解説しまぁす！

<div>
  <img src="https://blog.xoxzo.com/images/xoxtan.png" class="float-lg-right lg-width200 md-width300" style="margin: 0;">
</div>

こんにちはぁ！

実は、ミコちゃんのチュートリアル、お久しぶりなんデス。
使ってくれるみんなのために、APIを治したり、良くしたり・・・って、バタバタしてましたっ！
でも、また、戻ってきたからよろしくね！
じゃぁ、早速、新しいレッスンを始めちゃおう！

前回は、[音声案内を発信しましょう！]({filename}./making-a-simple-playback-call-ja.md) ということで、
指定した電話番号へ電話を発信して、準備しておいたmp3ファイルを再生するっていうのを、勉強しましたよね？

今回は、あなたの伝えたい内容を、もっと的確に伝えられるように、テキスト読み上げ機能（（Text-to-speech: TTSって言うわね）をつかって、電話をかける方法を
教えちゃうねっ！

実は、テキスト読み上げソフトを使うだけで、発信した電話を受け取った相手に、伝えたいことを大きく変えることが、できちゃうんです。
ということは、よく、「電話がかかってきて、 SMS認証コードを声でお知らせしてくれる」っていうようなことが、
 SMSメッセージを使って「文字で送る」かわりに、通話でできちゃうってことなんです！
 音声読み上げを使って、クライアントへのアップデート通知や、予約のリマインダー等、たったひとつのシンプルなAPIコールで行うことができます。
 [音声通話用webサービスAP](https://www.xoxzo.com/ja/about/voice-api/)について、もっと読んでみてね！

Googleとか、Facebookとかの、ネットの大きなサービス企業では、「通話してるデバイスを、本人がちゃんと保持してます」ってことを
認証する手段として、このやり方を使ってるよねっ？

<div style="clear:both;"></div>

## 必要なものは? ##

- まずは、通話のできる電話番号を、[E.164フォーマット](https://ja.wikipedia.org/wiki/E.164)で、準備してねっ！ 
このフォーマットは、つまり、先頭に + のついた、国番号 付きの電話番号ってことです！あと、有効な発信者番号もね。
- もちろん、APIユーザーも必要ね。api連携とは、web api 使い方、apiとは わかりやすく。。。これは、前にもチュートリアルで出てるから、
[最初のAPIユーザーをつくろう！]({filename}./create-your-first-apiuser-ja.md)に戻ってしっかり復習して、もしまだAPIユーザーを
つくってなかったら、つくっておいてくださいっ。
- あと、XoxzoのwebサービスAPIでは、SMS認証コードは自動作成しないから、発信したいSMS認証コードは、自分で準備しておいてね！

## いよいよ発信しましょう！ ##

ココでは、あなたの運営するサービスを「ウルトラ・サービス」そして準備した認証コードは「1234」だってことにするわねっ！
ただSMS認証コードだけを発信するんじゃなくて、お電話するんだから、ご挨拶も入れたいわよねぇ？・・・ということで、発信音声は、こんな感じで
どうかなぁ？

「もしもし、こんにちは。ウルトラ・サービスです。あなたの認証コードは、1234です。」

どう？　

そうよね。この電話を受取るひとにとっては、コードを覚えたり、メモしたりする余裕がほしいわよね。だから、コードの読み上げは
繰り返してあげるのが、親切だと思うのっ！

「もしもし、こんにちは。ウルトラ・サービスです。あなたの認証コードは、1234です。繰り返します。
あなたの認証コードは、1234です。」

このシンプル・プレイバック発信を行うURLは、`https://api.xoxzo.com/voice/simple/playbacks/`だから、
curlを使った場合、コマンドは、こんな感じになると思いまぁす。

```
curl -u th3ApISiDt3xtTh4tyoUcoPied:Th3aUthT0k3nth4tY0uCopi3D \
--data-urlencode 'caller=thecallerphonenumber' \
--data-urlencode 'recipient=yourphonenumber' \
--data-urlencode 'tts_lang=en' \
--data-urlencode 'tts_message="もしもし、こんにちは。ウルトラ・サービスです。あなたの認証コードは、1234です。繰り返します。
あなたの認証コードは、1234です。"' \
https://api.xoxzo.com/voice/simple/playbacks/
```

レスポンスは、callidが返りますよ。こんな感じ。 `[{"callid":"YoUr-5ucc355fuL-c4lL-Uu1D"}]` 
このcallidを使うと、 [やり方がドキュメンテーションに載ってるんだけど、](http://docs.xoxzo.com/ja/voice.html#checking-call-status) 
通話の後で、この発信の結果をチェックすることもできまぁす。

さて、今、ご案内した通りにやってみたあなたは、気づいたかなぁ。
読み上げられたコードは、「イチ・二・サン・シー」ではなかったわよね？「千二百三十四」（せんにひゃくさんじゅうよん）になってた？
ひとつひとつの数字を区切って、しかも数字と数字の間には、ちょっと間をあけて、コードを読んでほしい場合、
`tts_message`の部分は、コンマを使って、こうやってみて！

`
tts_message="もしもし、こんにちは。ウルトラ・サービスです。あなたの認証コードは、 1,,2,,3,,4です。繰り返します。
あなたの認証コードは、 1,,2,,3,,4です。"
`

いかがでしたか？？

これで、あなたの「ウルトラ・サービス」へアクセスできるコードを、利用者様の電話へお知らせすることができます。
それに、あなたの方も、この電話番号が実際に存在していて、受信した相手が、*タ・ブ・ン* 本物の人間だってことも、わかっちゃうよね！

ほかにも、Xoxzo webサービス apiでできる、すごいこと、たくさんあるから、その他の[ドキュメンテーション](https://docs.xoxzo.com/ja/)も、読んでみてね。
質問があったら、連絡してね。

ではまた次回！

[ミコちゃんのチュートリアル・シリーズ](https://blog.xoxzo.com/ja/tag/mikochiyan/)好評不定期連載中!

web api 使い方、電話 api、Xoxzo機能のデモのご希望にも、関東圏を中心に、お応えします。

ご不明な点があれば、是非 help@xoxzo.com までご連絡ください。

